# read csv file into a dataframe
stroke_data <- read.csv("stroke.csv", na = "")

stroke_data

# Check duplicate data
sum(duplicated(stroke_data))

# Examine the data type and 
# show the structure of dataframe
str(stroke_data)

# Change N/A of bmi to NA
# and convert bmi from chr to numerical
stroke_data$bmi[stroke_data$bmi == "N/A"] <- NA

stroke_data$bmi <- as.numeric(stroke_data$bmi)

str(stroke_data)

# Convert the Date to date str
# by using as.Date()
# Using "%A %d %B %Y"
# %A is unabbreviated weekday; %d is day; 
# %B is unabbreviated month; %Y is 4-digit year
stroke_data$Date <- as.Date(stroke_data$Date, "%A %d %B %Y")

# Create new col named weekday
# that contains day of the week
# using weekdays() to extract the weekday of the date
stroke_data$weekday <- weekdays(stroke_data$Date)

# Use mice and VIM package
# to show the missing values
library(mice)
library(VIM)
md.pattern(stroke_data, rotate.names = TRUE)

missing_values <- aggr(stroke_data, 
                       prop = FALSE, 
                       numbers = TRUE, 
                       cex.axis = 0.59)

# summary of missing_values
summary(missing_values)

# 4% BMI data missing

# Use !complete.case to get the missing data
# and store in incomplete_data
incomplete_data <- stroke_data[!complete.cases(stroke_data),]
nrow(incomplete_data)

# use na.omit() to drop the missing data
# and check the NA
stroke_data <- na.omit(stroke_data)
sum(is.na(stroke_data))

# capture the parameters to opar
opar <- par(no.readonly = TRUE)

# Store the patient had stroke to new dataframe 
# named patient_stroke
patient_stroke <- stroke_data[stroke_data$stroke == 1, ]

# And patient NOT had stroke to another dataframe 
# named patient_healthy
patient_healthy <- stroke_data[!stroke_data$stroke == 1, ]

# Use sum to count the patient who had stroke
# and use nrow to count the patient NOT had stroke
stroke_sum <- sum(stroke_data$stroke[stroke_data$stroke == 1])
healthy_sum <- nrow(stroke_data[stroke_data$stroke == 0, ]) 

# Calculate the percentage of patient had stroke
# stroke percentage = stroke /  * 100
# healthy percentage = 100 - stroke percentage
# round the values to 0 decimal places
stroke_per <- c(round(stroke_sum / nrow(stroke_data) * 100), 
                          round(100 - (stroke_sum / nrow(stroke_data) * 100)))

# Using barplot to plot the percentage of patient had stroke
# red = stroke,  blue = healthy
barplot(stroke_per, 
        col = c("red", "blue"), 
        main = "Percentage of Patient had Stroke",
        ylab = "Percentage", 
        ylim = c(0,105), 
        names.arg = c("Stroke", "Healthy"))
axis(2, at = 0:100 * 10)
text(0.7, 5, labels = stroke_per[1],
     pos = 3)
text(0.75, 5, labels = "%",
     pos = 3)
text(1.9, 95, labels = stroke_per[2],
     pos = 3)
text(1.96, 95, labels = "%",
     pos = 3)

# Distribution of Age - Sroke vs Healthy
# function density - kernel density estimates

# use density on stroke_date$age to get the overall density of age
# called age_kde
age_kde <- density(stroke_data$age)

# density on patient_stroke$age called stroke_age_kde
stroke_age_kde <- density(patient_stroke$age)
# density on patient_healthy$age called healthy_age_kde
healthy_age_kde <- density(patient_healthy$age)

# create a 2 x 2 plot
# show 4 plot in 2 rows and 2 cols
par(mfrow = c(2, 2))

# First plot is Density of Overall Age
# which show the density of age
plot(age_kde, 
     main = "Density of Overall Age", 
     ylab = "", 
     yaxt = "n", 
     xlab = "Age")

# Second plot is Histogram of Overall Age
# which show the histogram of age
# and density of age using lines()
hist(stroke_data$age, 
     main = "Histogram of Overall Age", 
     prob = TRUE, 
     ylab = "", 
     yaxt = "n", 
     xlab = "Age")
lines(age_kde, col = "red")

#Third plot is showing the density of Stroke vs Healthy
# red line is Stroke patient
# blue line is Healthy patient
plot(stroke_age_kde, 
     col = "red", 
     main = "Density of Age - Stroke vs Healthy", 
     ylab = "", yaxt="n", xlab = "Age")
lines(healthy_age_kde, col = "blue")
legend("topleft", legend = c("Stroke", "Healthy"), 
       col = c("red", "blue"), lty=1, cex=0.8)

# Last plot is the histogram of the patient had Stroke
# and show the lines of density of Stroke
hist(patient_stroke$age, 
     main = "Histogram of Age - Stroke", 
     prob = TRUE, 
     ylab = "", 
     yaxt = "n", 
     xlab = "Age")
lines(stroke_age_kde, col = "red")

# return parameters to default
par(opar)

bmi_kde <- density(stroke_data$bmi)
plot(bmi_kde)

boxplot(stroke_data$bmi)

t.test(stroke_data$bmi, mu = 25, conf.level = 0.95)

boxplot(summary(factor(stroke_data$gender)))

male_stroke_per <- 
  nrow(patient_stroke[patient_stroke$gender == "Male", ]) / 
  nrow(stroke_data[stroke_data$gender == "Male", ]) * 100

female_stroke_per <- 
  nrow(patient_stroke[patient_stroke$gender == "Female", ]) /
  nrow(stroke_data[stroke_data$gender == "Female", ]) * 100

male_percentage <- nrow(stroke_data[stroke_data$gender == "Male", ]) / 
  nrow(stroke_data) * 100

